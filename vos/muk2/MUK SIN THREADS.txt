MINIX AS A UNIKERNEL (MUK) SIN THREADS 
=======================================


http://man7.org/linux/man-pages/man3/insque.3.html
http://man7.org/linux/man-pages/man3/SLIST_HEAD.3.html

https://www.geeksforgeeks.org/g-fact22-concept-of-setjump-and-longjump/
https://publications.gbdirect.co.uk/c_book/chapter9/nonlocal_jumps.html

       The functions described on this page are used for performing
       "nonlocal gotos": transferring execution from one function to a
       predetermined location in another function.

La idea es implementar un scheduler que invoque a funciones 

main ()
{
	main_init();
	while(true) {
		next_funct = get_from_queue(); // obtiene la proxima funcion a ejecutar de una cola de funciones.
		if( next_funct == NULL)
			mnx_receive(ANY, msg);
		else
			next_funct();
	}
}

Como se implementaria un servidor tipico
========================================
	
server (where)
{
	goto where; 
	svr_init();
	while( TRUE){
		rcode = receive(ANY, &msg);
to_switch:
		switch(msg.type){
			case SERVICE1:
				rcode = call_service1();
				break;
			case SERVICE2:
				rcode = call_service2();
				break;				
		}
to_send:
		rcode = send(msg.source, rply_msg);
to_receive:
	}
}	

Las funciones bloqueantes son las de IPC.
	Por lo tanto, supongamos receive(ANY, &msg)
	
	sender = search(p_list);
	if( sender == NULL) 
		// no hay mensajes
	else {
		server->p_rts_flags = RECEIVING;
		server->p_getfrom   = ANY;
		server->p_mptr		= &msg;
		return();
	}
	
	
receive()
{
	buscar en la cola del proceso si hay alguien queriendo envier
		si hay alguien	
			es el que espero?
				si, copiar el mensaje, poner en cola al sender, cambiarle los flags
				no, setear los flags, sacar de cola al receiver, return()
							
}
	
linked list 
https://www.includehelp.com/ds/implementation-of-priority-queue-using-linked-list.aspx

fijarse tambien en MINIX4RT


QUE HACER CUANDO UN PROCESO INTERNO SE COMUNICA CON UN EXTERNO.
Como el INTERNO se puede bloquear, debe crear un thread para esperar.


Se podria realizar el mismo tratamiento que con interrupciones.
Es decir. tener un thread por cada endpoint que recibe o envia mensajes
y cuando recibe un mensaje, pone una marca en el descriptor del proceso (similar al notify)
y activa el proceso.

CADA PROCESO deberia armarce como bloques. Supongamos


MINIX AS A UNIKERNEL (MUK) SIN THREADS 
=======================================

La idea es implementar un scheduler que invoque a funciones 

main ()
{
	main_init();
	while(true) {
		next_funct = get_from_queue(); // obtiene la proxima funcion a ejecutar de una cola de funciones.
		if( next_funct == NULL)
			mnx_receive(ANY, msg);
		else
			next_funct();
	}
}

Como se implementaria un servidor tipico
========================================
	
server (where)
{
	goto where; 
	svr_init();
	while( TRUE){
		rcode = receive(ANY, &msg);
to_switch:
		switch(msg.type){
			case SERVICE1:
				rcode = call_service1();
				break;
			case SERVICE2:
				rcode = call_service2();
				break;				
		}
to_send:
		rcode = send(msg.source, rply_msg);
to_receive:
	}
}	

Las funciones bloqueantes son las de IPC.
	Por lo tanto, supongamos receive(ANY, &msg)
	
	sender = search(p_list);
	if( sender == NULL) 
		// no hay mensajes
	else {
		server->p_rts_flags = RECEIVING;
		server->p_getfrom   = ANY;
		server->p_mptr		= &msg;
		return();
	}
	
	
receive()
{
	buscar en la cola del proceso si hay alguien queriendo envier
		si hay alguien	
			es el que espero?
				si, copiar el mensaje, poner en cola al sender, cambiarle los flags
				no, setear los flags, sacar de cola al receiver, return()
							
}
	
linked list 
https://www.includehelp.com/ds/implementation-of-priority-queue-using-linked-list.aspx
https://linux.die.net/man/3/queue

fijarse tambien en MINIX4RT

QUE HACER CUANDO UN PROCESO INTERNO SE COMUNICA CON UN EXTERNO.
Como el INTERNO se puede bloquear, debe crear un thread para esperar.


Se podria realizar el mismo tratamiento que con interrupciones.
Es decir. tener un thread por cada endpoint que recibe o envia mensajes
y cuando recibe un mensaje, pone una marca en el descriptor del proceso (similar al notify)
y activa el proceso.

CADA PROCESO deberia armarce como bloques. Supongamos

=====================================================================================================
20190914:
	cree un programa de prueba muk2.c 
	
SECUENCIA DE EJECUCION DE CLIENT 

	root@node0:/usr/src/dvs/vos/muk2# ./muk2 | grep client
	 muk2.c:init_client:97:
	 muk2.c:init_client:110:nr=1 endp=1 flags=0 misc=0 name=CLIENT
	 muk2.c:muk_client:170:
	 muk2.c:muk_client:177:stop 1
	 muk2.c:muk_client:179:stop 1a
	 muk2.c:muk_client:182:return 1
	 muk2.c:muk_client:179:stop 1a
	 muk2.c:muk_client:187:stop 2
	 muk2.c:muk_client:189:stop 2a
	 muk2.c:muk_client:192:return 2
	 muk2.c:muk_client:189:stop 2a
	 muk2.c:muk_client:197:stop 3
	 muk2.c:muk_client:199:stop 3a
	 muk2.c:muk_client:202:return 3
	 muk2.c:muk_client:199:stop 3a
	 muk2.c:muk_client:177:stop 1
	 muk2.c:muk_client:179:stop 1a
	 muk2.c:muk_client:182:return 1
	 muk2.c:muk_client:179:stop 1a
	 muk2.c:muk_client:187:stop 2
	 muk2.c:muk_client:189:stop 2a
	 muk2.c:muk_client:192:return 2
	 muk2.c:muk_client:189:stop 2a
	 muk2.c:muk_client:197:stop 3
	 muk2.c:muk_client:199:stop 3a
	 muk2.c:muk_client:202:return 3
	 muk2.c:muk_client:199:stop 3a
	 muk2.c:muk_client:177:stop 1
	 muk2.c:muk_client:179:stop 1a
	 muk2.c:muk_client:182:return 1


SECUENCIA DE EJECUCION DEL SERVER 
root@node0:/usr/src/dvs/vos/muk2# ./muk2 | grep server
 muk2.c:init_server:75:
 muk2.c:init_server:87:nr=0 endp=0 flags=0 misc=0 name=SERVER
 muk2.c:muk_server:121:
 muk2.c:muk_server:128:stop 1
 muk2.c:muk_server:130:stop 1a
 muk2.c:muk_server:133:return 1
 muk2.c:muk_server:130:stop 1a
 muk2.c:muk_server:138:stop 2
 muk2.c:muk_server:140:stop 2a
 muk2.c:muk_server:143:return 2
 muk2.c:muk_server:140:stop 2a
 muk2.c:muk_server:148:stop 3
 muk2.c:muk_server:150:stop 3a
 muk2.c:muk_server:153:return 3
 muk2.c:muk_server:150:stop 3a
 muk2.c:muk_server:128:stop 1
 muk2.c:muk_server:130:stop 1a
 muk2.c:muk_server:133:return 1
 muk2.c:muk_server:130:stop 1a
 muk2.c:muk_server:138:stop 2
 muk2.c:muk_server:140:stop 2a
 muk2.c:muk_server:143:return 2
 muk2.c:muk_server:140:stop 2a
 muk2.c:muk_server:148:stop 3
 muk2.c:muk_server:150:stop 3a
 muk2.c:muk_server:153:return 3
 muk2.c:muk_server:150:stop 3a
 muk2.c:muk_server:128:stop 1
 muk2.c:muk_server:130:stop 1a
 muk2.c:muk_server:133:return 1
 muk2.c:muk_server:130:stop 1a

 
DESPUES DE MOFICADO EL CODIGO

root@node0:/usr/src/dvs/vos/muk2# ./muk2 
 muk2.c:init_main:142:
 muk2.c:init_server:153:
 muk2.c:init_server:165:nr=0 flags=0 misc=0 name=SERVER
 muk2.c:init_client:175:
 muk2.c:init_client:188:nr=1 flags=0 misc=0 name=CLIENT
 muk2.c:muk_sched:299:stage=0
 muk2.c:muk_client:243:stage=0
MUK2_RETURN: muk2.c:muk_client:246: rcode=2
 muk2.c:pick_proc:285:
 muk2.c:pick_proc:288:p_nr=0
 muk2.c:muk_sched:305:current_nr=0
 muk2.c:muk_sched:314:before longjmp current_nr=0
ViolaciÃ³n de segmento


=====================================================================================================
20190915:
		SE BAJA LA LIBRERIA libtask 
		https://swtch.com/libtask/
		
=====================================================================================================
20190917:	ya compilo PM, RDISK y SYSTASK 
		Faltan compilar las librerias syslib, mollib 
		
=====================================================================================================
20190919:		
		Se implmento muk_sendrec 

	
=====================================================================================================
20190922:	 SYSTASK+RDISK+PM 

=====================================================================================================
20190924:	 SYSTASK+RDISK+PM+FS+IS+NWEB+FTP 

=====================================================================================================
20190925:	
		Se convirtieron todas las librerias de .so a  .a (estaticas)

		Se adaptaron M3NWEB y WIS para que use los sockets como usa tcpproxy.c 

=====================================================================================================
20190928:	NO FUNCIONAN CORRECTAMENTE NI WIS NI M3NWEB

	WIS: Cada peticion crea una nueva tarea y funciona perfecto.
	Probando WIS ANDAN TODOS 
	    
	Se convirtieron todas las librerias de .so a  .a (estaticas) en MUK !!!
			

=====================================================================================================
20190929:	
			NO FUNCIONA EL M3NWEB 
			LA IMAGEN DE DISKETTE PARECE ESTAR CORRECTA COMPROBADA CON fuse-mfs
			
			SOLUCION: CREAR UNA TASK NUEVA POR CADA PETICION  TAL COMO LO HACE EL ftpproxy.c DE EJEMPLO DE LIBTASK 
				RESPUESTA: NO SE PUEDE PORQUE CADA TAREA REQUIRE BINDEARSE PARA PODER COMUNICARSE CON FS 
							EL BIND NO SOLO SE HACE CONTRA EL MUK SINO TAMBIEN CONTRA SYSTASK Y PM 
							
			FUNCIONO M3NWEB Y  WIS PERFECTAMENTE
			
			El problema era que en los MUK_vcopy() se estaba utilizando SELF.
			

=====================================================================================================
20190930:		
		SE CREARON MACROS PARA UTILIZAR DVK IPC SIN ESPERA (POOLING CON TIMEOUT)

		Se cambio M3FTP para que utilice estas primitivas
		
		se intento ejecutar:
			nsenter -p -t $DC0 ./m3ftp g 0 file10M.txt file10M.out
		
		SERVER MIENTRAS ESPERA 
			[ 7078.953708] DEBUG 1642:SYSC_ipc:163: ipc_mini_receive: call=768 first=31438 second=0 third=0 fifth=0 
			[ 7078.962221] DEBUG 1642:ipc_mini_receive:299: src_ep=31438
			[ 7078.965600] DEBUG 1642:check_caller:545: caller_pid=1642 caller_tgid=1642
			[ 7078.967614] DEBUG 1642:check_caller:581: WLOCK_PROC ep=14 count=0
			[ 7078.969549] DEBUG 1642:check_caller:610: WUNLOCK_PROC ep=14 count=0
			[ 7078.972089] DEBUG 1642:check_caller:613: dcid=0
			[ 7078.974633] DEBUG 1642:check_caller:617: RLOCK_DC dc=0 count=0
			[ 7078.976446] DEBUG 1642:check_caller:621: RUNLOCK_DC dc=0 count=0
			[ 7078.978367] DEBUG 1642:check_caller:627: caller_pid=1642 
			[ 7078.980196] DEBUG 1642:ipc_mini_receive:310: RLOCK_PROC ep=14 count=0
			[ 7078.982172] DEBUG 1642:ipc_mini_receive:314: caller_nr=14 caller_ep=14 src_ep=31438 
			[ 7078.984184] DEBUG 1642:ipc_mini_receive:318: dcid=0
			[ 7078.986140] DEBUG 1642:ipc_mini_receive:322: RUNLOCK_PROC ep=14 count=0
			[ 7078.987998] DEBUG 1642:ipc_mini_receive:324: RLOCK_DC dc=0 count=0
			[ 7078.990741] DEBUG 1642:ipc_mini_receive:327: RUNLOCK_DC dc=0 count=0
			[ 7078.993871] DEBUG 1642:ipc_mini_receive:377: WLOCK_PROC ep=14 count=0
			[ 7078.995612] DEBUG 1642:ipc_mini_receive:482: Any suitable message from 31438 was not found.
			[ 7078.997400] DEBUG 1642:sleep_proc:353: timeout=0
			[ 7078.999035] DEBUG 1642:ipc_mini_receive:499: WUNLOCK_PROC ep=14 count=0
			[ 7079.002013] ERROR: 1642:ipc_mini_receive:500: rcode=-11
			
			root@node0:~# cat /proc/dvs/DC0/procs 
			DC pnr -endp -lpid/vpid- nd flag misc -getf -sndt -wmig -prxy name
			 0  14    14  1642/19     0    0   20 27342 27342 27342 27342 muk2           
			 0  15    15  1656/20     0    8   20    14 27342 27342 27342 m3ft
			
		SERVER 
 task.c:get_task:104:p_ep=30 p_nr=30
 task.c:get_task:104:p_ep=31 p_nr=31
 task.c:get_task:104:p_ep=32 p_nr=32
 task.c:get_task:104:p_ep=33 p_nr=33
 task.c:get_task:104:p_ep=34 p_nr=34
 task.c:get_task:104:p_ep=35 p_nr=35
 task.c:get_task:104:p_ep=36 p_nr=36
 task.c:get_task:104:p_ep=37 p_nr=37
 task.c:get_task:104:p_ep=38 p_nr=38
 task.c:get_task:104:p_ep=39 p_nr=39
 task.c:get_task:104:p_ep=40 p_nr=40
 task.c:get_task:104:p_ep=41 p_nr=41
 task.c:get_task:104:p_ep=42 p_nr=42
 task.c:get_task:104:p_ep=43 p_nr=43
 task.c:get_task:104:p_ep=44 p_nr=44
 task.c:get_task:104:p_ep=45 p_nr=45
 task.c:get_task:104:p_ep=46 p_nr=46
 task.c:get_task:104:p_ep=47 p_nr=47
 task.c:get_task:104:p_ep=48 p_nr=48
 task.c:get_task:104:p_ep=49 p_nr=49
 task.c:get_task:104:p_ep=50 p_nr=50
 task.c:get_task:104:p_ep=51 p_nr=51
 task.c:get_task:104:p_ep=52 p_nr=52
 task.c:get_task:104:p_ep=53 p_nr=53
 task.c:get_task:104:p_ep=54 p_nr=54
 task.c:get_task:104:p_ep=55 p_nr=55
 task.c:get_task:104:p_ep=56 p_nr=56
 task.c:get_task:104:p_ep=57 p_nr=57
 task.c:get_task:104:p_ep=58 p_nr=58
 task.c:get_task:104:p_ep=59 p_nr=59
 task.c:get_task:104:p_ep=60 p_nr=60
 task.c:get_task:104:p_ep=61 p_nr=61
 task.c:get_task:104:p_ep=62 p_nr=62
 task.c:get_task:104:p_ep=63 p_nr=63
 task.c:get_task:104:p_ep=64 p_nr=64
 task.c:get_task:104:p_ep=65 p_nr=65
 task.c:get_task:104:p_ep=66 p_nr=66
 task.c:get_task:104:p_ep=67 p_nr=67
 task.c:get_task:104:p_ep=68 p_nr=68
 task.c:get_task:104:p_ep=69 p_nr=69
 task.c:get_task:104:p_ep=70 p_nr=70
 task.c:get_task:104:p_ep=71 p_nr=71
 task.c:get_task:104:p_ep=72 p_nr=72
 task.c:get_task:104:p_ep=73 p_nr=73
 task.c:get_task:104:p_ep=74 p_nr=74
 task.c:get_task:104:p_ep=75 p_nr=75
 task.c:get_task:104:p_ep=76 p_nr=76
 task.c:get_task:104:p_ep=77 p_nr=77
 task.c:get_task:104:p_ep=78 p_nr=78
 task.c:get_task:104:p_ep=79 p_nr=79
 task.c:get_task:104:p_ep=80 p_nr=80
 task.c:get_task:104:p_ep=81 p_nr=81
 task.c:get_task:104:p_ep=82 p_nr=82
 task.c:get_task:104:p_ep=83 p_nr=83
 task.c:get_task:104:p_ep=84 p_nr=84
 task.c:get_task:104:p_ep=85 p_nr=85
 task.c:get_task:104:p_ep=86 p_nr=86
 task.c:get_task:104:p_ep=87 p_nr=87
 task.c:get_task:104:p_ep=88 p_nr=88
 task.c:get_task:104:p_ep=89 p_nr=89
 task.c:get_task:104:p_ep=90 p_nr=90
 task.c:get_task:104:p_ep=91 p_nr=91
 task.c:get_task:104:p_ep=92 p_nr=92
 task.c:get_task:104:p_ep=93 p_nr=93
 task.c:get_task:104:p_ep=94 p_nr=94
 task.c:get_task:104:p_ep=95 p_nr=95
 task.c:get_task:104:p_ep=96 p_nr=96
 task.c:get_task:104:p_ep=97 p_nr=97
 task.c:get_task:104:p_ep=98 p_nr=98
 task.c:get_task:104:p_ep=99 p_nr=99
 task.c:get_task:104:p_ep=100 p_nr=100
 task.c:get_task:104:p_ep=101 p_nr=101
 task.c:get_task:104:p_ep=102 p_nr=102
 task.c:get_task:104:p_ep=103 p_nr=103
 task.c:get_task:104:p_ep=104 p_nr=104
 task.c:get_task:104:p_ep=105 p_nr=105
 task.c:get_task:104:p_ep=106 p_nr=106
 task.c:get_task:104:p_ep=107 p_nr=107
 task.c:get_task:104:p_ep=108 p_nr=108
 task.c:get_task:104:p_ep=109 p_nr=109
 task.c:get_task:104:p_ep=110 p_nr=110
 task.c:get_task:104:p_ep=111 p_nr=111
 task.c:get_task:104:p_ep=112 p_nr=112
 task.c:get_task:104:p_ep=113 p_nr=113
 task.c:get_task:104:p_ep=114 p_nr=114
 task.c:get_task:104:p_ep=115 p_nr=115
 task.c:get_task:104:p_ep=116 p_nr=116
 task.c:get_task:104:p_ep=117 p_nr=117
 task.c:get_task:104:p_ep=118 p_nr=118
 task.c:get_task:104:p_ep=119 p_nr=119
 task.c:get_task:104:p_ep=120 p_nr=120
 task.c:get_task:104:p_ep=121 p_nr=121
 task.c:get_task:104:p_ep=122 p_nr=122
 task.c:get_task:104:p_ep=123 p_nr=123
 task.c:get_task:104:p_ep=124 p_nr=124
 task.c:get_task:104:p_ep=125 p_nr=125
 task.c:get_task:104:p_ep=126 p_nr=126
 task.c:get_task:104:p_ep=127 p_nr=127
 task.c:get_task:104:p_ep=128 p_nr=128
 task.c:get_task:104:p_ep=129 p_nr=129
 task.c:get_task:104:p_ep=130 p_nr=130
 task.c:get_task:104:p_ep=131 p_nr=131
 task.c:get_task:104:p_ep=132 p_nr=132
 task.c:get_task:104:p_ep=133 p_nr=133
 task.c:get_task:104:p_ep=134 p_nr=134
 task.c:get_task:104:p_ep=135 p_nr=135
 task.c:get_task:104:p_ep=136 p_nr=136
 task.c:get_task:104:p_ep=137 p_nr=137
 task.c:get_task:104:p_ep=138 p_nr=138
 task.c:get_task:104:p_ep=139 p_nr=139
 task.c:get_task:104:p_ep=140 p_nr=140
 task.c:get_task:104:p_ep=141 p_nr=141
 task.c:get_task:104:p_ep=142 p_nr=142
 task.c:get_task:104:p_ep=143 p_nr=143
 task.c:get_task:104:p_ep=144 p_nr=144
 task.c:get_task:104:p_ep=145 p_nr=145
 task.c:get_task:104:p_ep=146 p_nr=146
 task.c:get_task:104:p_ep=147 p_nr=147
 task.c:get_task:104:p_ep=148 p_nr=148
 task.c:get_task:104:p_ep=149 p_nr=149
 task.c:get_task:104:p_ep=150 p_nr=150
 task.c:get_task:104:p_ep=151 p_nr=151
 task.c:get_task:104:p_ep=152 p_nr=152
 task.c:get_task:104:p_ep=153 p_nr=153
 task.c:get_task:104:p_ep=154 p_nr=154
 task.c:get_task:104:p_ep=155 p_nr=155
 task.c:get_task:104:p_ep=156 p_nr=156
 task.c:get_task:104:p_ep=157 p_nr=157
 task.c:get_task:104:p_ep=158 p_nr=158
 task.c:get_task:104:p_ep=159 p_nr=159
 task.c:get_task:104:p_ep=160 p_nr=160
 task.c:get_task:104:p_ep=161 p_nr=161
 task.c:get_task:104:p_ep=162 p_nr=162
 task.c:get_task:104:p_ep=163 p_nr=163
 task.c:get_task:104:p_ep=164 p_nr=164
 task.c:get_task:104:p_ep=165 p_nr=165
 task.c:get_task:104:p_ep=166 p_nr=166
 task.c:get_task:104:p_ep=167 p_nr=167
 task.c:get_task:104:p_ep=168 p_nr=168
 task.c:get_task:104:p_ep=169 p_nr=169
 task.c:get_task:104:p_ep=170 p_nr=170
 task.c:get_task:104:p_ep=171 p_nr=171
 task.c:get_task:104:p_ep=172 p_nr=172
 task.c:get_task:104:p_ep=173 p_nr=173
 task.c:get_task:104:p_ep=174 p_nr=174
 task.c:get_task:104:p_ep=175 p_nr=175
 task.c:get_task:104:p_ep=176 p_nr=176
 task.c:get_task:104:p_ep=177 p_nr=177
 task.c:get_task:104:p_ep=178 p_nr=178
 task.c:get_task:104:p_ep=179 p_nr=179
 task.c:get_task:104:p_ep=180 p_nr=180
 task.c:get_task:104:p_ep=181 p_nr=181
 task.c:get_task:104:p_ep=182 p_nr=182
 task.c:get_task:104:p_ep=183 p_nr=183
 task.c:get_task:104:p_ep=184 p_nr=184
 task.c:get_task:104:p_ep=185 p_nr=185
 task.c:get_task:104:p_ep=186 p_nr=186
 task.c:get_task:104:p_ep=187 p_nr=187
 task.c:get_task:104:p_ep=188 p_nr=188
 task.c:get_task:104:p_ep=189 p_nr=189
 task.c:get_task:104:p_ep=190 p_nr=190
 task.c:get_task:104:p_ep=191 p_nr=191
 task.c:get_task:104:p_ep=192 p_nr=192
 task.c:get_task:104:p_ep=193 p_nr=193
 task.c:get_task:104:p_ep=194 p_nr=194
 task.c:get_task:104:p_ep=195 p_nr=195
 task.c:get_task:104:p_ep=196 p_nr=196
 task.c:get_task:104:p_ep=197 p_nr=197
 task.c:get_task:104:p_ep=198 p_nr=198
 task.c:get_task:104:p_ep=199 p_nr=199
 task.c:get_task:104:p_ep=200 p_nr=200
 task.c:get_task:104:p_ep=201 p_nr=201
 task.c:get_task:104:p_ep=202 p_nr=202
 task.c:get_task:104:p_ep=203 p_nr=203
 task.c:get_task:104:p_ep=204 p_nr=204
 task.c:get_task:104:p_ep=205 p_nr=205
 task.c:get_task:104:p_ep=206 p_nr=206
 task.c:get_task:104:p_ep=207 p_nr=207
 task.c:get_task:104:p_ep=208 p_nr=208
 task.c:get_task:104:p_ep=209 p_nr=209
 task.c:get_task:104:p_ep=210 p_nr=210
 task.c:get_task:104:p_ep=211 p_nr=211
 task.c:get_task:104:p_ep=212 p_nr=212
 task.c:get_task:104:p_ep=213 p_nr=213
 task.c:get_task:104:p_ep=214 p_nr=214
 task.c:get_task:104:p_ep=215 p_nr=215
 task.c:get_task:104:p_ep=216 p_nr=216
 task.c:get_task:104:p_ep=217 p_nr=217
 task.c:get_task:104:p_ep=218 p_nr=218
 task.c:get_task:104:p_ep=219 p_nr=219
 task.c:get_task:104:p_ep=220 p_nr=220
 m3ftpd.c:main_ftpd:140:MTX_LOCK muk_mutex:1
 m3ftpd.c:main_ftpd:141:MTX_UNLOCK muk_mutex:1
DEBUG 21:dvk_receive_T:834: endpoint=31438 timeout=0
DEBUG 21:dvk_receive_T:838: ipc ret=-1
ERROR: 21:dvk_receive_T:857: rcode=-1
 m3ftpd.c:main_ftpd:147:M3FTPD: muk_receive_T  rcode=-11
 m3ftpd.c:main_ftpd:149:M3FTPD: muk_receive_T TIMEOUT
DEBUG 21:dvk_receive_T:834: endpoint=31438 timeout=0
DEBUG 21:dvk_receive_T:838: ipc ret=-1
ERROR: 21:dvk_receive_T:857: rcode=-1
 m3ftpd.c:main_ftpd:147:M3FTPD: muk_receive_T  rcode=-11
 m3ftpd.c:main_ftpd:149:M3FTPD: muk_receive_T TIMEOUT
DEBUG 21:dvk_receive_T:834: endpoint=31438 timeout=0
DEBUG 21:dvk_receive_T:838: ipc ret=-1
ERROR: 21:dvk_receive_T:857: rcode=-1
 m3ftpd.c:main_ftpd:147:M3FTPD: muk_receive_T  rcode=-11
 m3ftpd.c:main_ftpd:149:M3FTPD: muk_receive_T TIMEOUT
DEBUG 21:dvk_receive_T:834: endpoint=31438 timeout=0
DEBUG 21:dvk_receive_T:838: ipc ret=0
 m3ftpd.c:main_ftpd:147:M3FTPD: muk_receive_T  rcode=0
 m3ftpd.c:main_ftpd:154:M3FTPD: source=15 type=1 m1i1=11 m1i2=0 m1i3=0 m1p1=0xbfa58e21 m1p2=(nil) m1p3=(nil) 
DEBUG 21:dvk_vcopy:122: src_ep=15 dst_ep=14 bytes=11
DEBUG 21:dvk_vcopy:126: ipc ret=11
 m3ftpd.c:main_ftpd:180:M3FTPD: path >file10M.txt<
DEBUG 21:dvk_send_T:803: endpoint=15 timeout=0
DEBUG 21:dvk_send_T:807: ipc ret=76
 m3ftpd.c:main_ftpd:192:M3FTPD: FTP_GET filename:file10M.txt
 mol_open.c:mol_open:8:name=file10M.txt flags=0
 task.c:get_task:104:p_ep=14 p_nr=14
 task.c:get_task:113:pproc=50A9920
 mukipc.c:muk_sendrec_T:483:nr=14 id=11 flags=00000000 misc=00000400 p_getfrom=27342 p_sendto=27342 name=m3ftp 
 mukipc.c:muk_sendrec_T:485:srcdst_ep:1
 task.c:get_task:104:p_ep=1 p_nr=1
 task.c:get_task:113:pproc=50A98EC
 mukipc.c:muk_sendrec_T:491:nr=1 id=7 flags=00000008 misc=00000400 p_getfrom=31438 p_sendto=27342 name=fs 
 mukipc.c:muk_sendrec_T:498:SENDING HALF
 mukipc.c:muk_sendrec_T:504:destination is waiting. Copy the message and wakeup destination
 rendez.c:_taskwakeup:25:
 rendez.c:_taskwakeup:32:ep=1
 rendez.c:_taskwakeup:35:i=1
 mukipc.c:muk_sendrec_T:513:nr=14 id=11 flags=00000008 misc=00000400 p_getfrom=1 p_sendto=27342 name=m3ftp 
 mukipc.c:muk_sendrec_T:514:before tasksleep 14
 rendez.c:tasksleep:9:id=11
 mukipc.c:muk_receive_T:253:after tasksleep 1, p_error=0 
 fs.c:fs_get_work:159:source=14 type=5 m1i1=12 m1i2=0 m1i3=87670784 m1p1=0x656c6966 m1p2=0x2e4d3031 m1p3=0x747874 
 fs.c:fs_get_work:160:source=14 type=5 m3i1=12 m3i2=0 m3p1=0x539c000 m3ca1=[file10M.txt]
 fs.c:fs_get_work:182:fs_call_nr = 5 
 open.c:fs_open:67:M3
 utility.c:fetch_name:130:fs_who_e=14 path=539C000 len=12 flag=3
 utility.c:fetch_name:142:M3=3
 utility.c:fetch_name:143:M3_STRING=14
 utility.c:fetch_name:157:user_path=file10M.txt
 open.c:common_open:96:oflags=0 omode=0
 filedes.c:get_fd:33:start=0 mode=4
 filedes.c:get_fd:39:FD located is=0
 open.c:common_open:102:fs_m_in.fd=0 oflags=0 
 open.c:common_open:118:user_path=file10M.txt
 path.c:parse_path:47:path=file10M.txt string=(null) action=0 
 path.c:parse_path:55:RELATIVE: fp_endpoint=14 i_num=1
 inode.c:dup_inode:380:
 path.c:parse_path:98:string = file10M.txt
 protect.c:forbidden:186:access_desired=1 
 protect.c:forbidden:187:perm_bits=7 perm_bits(OCT)=07
 protect.c:forbidden:188:access_desired=1 access_desired(OCT)=01
 protect.c:forbidden:203:r=0
 read.c:read_map:396:position=0
 cache.c:rw_block:102:
 super.c:get_block_size:28:
 cache.c:rw_block:106:bp->b_blocknr= 395 block_size=4096
 cache.c:rw_block:117: dev_io -> op=1027, dev=768, POS=1617920, BYTES=4096
 device.c:dev_io:120:op=403 dev=768 major=3 minor=0 proc_e=1 pos=1617920 bytes=4096 flags=0
 device.c:dev_io:131: DEV_READ -> m_type=1027, dev=768, POS=1617920, IO_ENDPT=1, COUNT=4096
 device.c:dev_io:175:dmap_driver=3 source=-1216958464 type=1027 m2i1=0 m2i2=1 m2i3=4096 m2l1=1617920 m2l2=0 m2p1=0x5afbd4
 device.c:r_gen_io:435:task_nr=3 source=-1216958464 type=1027 m2i1=0 m2i2=1 m2i3=4096 m2l1=1617920 m2l2=0 m2p1=0x5afbd4
 device.c:r_gen_io:474: m_type=1027, COUNT/FLAGS=4096
 task.c:get_task:104:p_ep=1 p_nr=1
 task.c:get_task:113:pproc=50A98EC
 mukipc.c:muk_sendrec_T:483:nr=1 id=7 flags=00000000 misc=00000400 p_getfrom=27342 p_sendto=27342 name=fs 
 mukipc.c:muk_sendrec_T:485:srcdst_ep:3
 task.c:get_task:104:p_ep=3 p_nr=3
 task.c:get_task:113:pproc=50A98F4
 mukipc.c:muk_sendrec_T:491:nr=3 id=5 flags=00000008 misc=00000400 p_getfrom=31438 p_sendto=27342 name=rdisk 
 mukipc.c:muk_sendrec_T:498:SENDING HALF
 mukipc.c:muk_sendrec_T:504:destination is waiting. Copy the message and wakeup destination
 rendez.c:_taskwakeup:25:
 rendez.c:_taskwakeup:32:ep=3
 rendez.c:_taskwakeup:35:i=1
 mukipc.c:muk_sendrec_T:513:nr=1 id=7 flags=00000008 misc=00000400 p_getfrom=3 p_sendto=27342 name=fs 
 mukipc.c:muk_sendrec_T:514:before tasksleep 1
 rendez.c:tasksleep:9:id=7
 mukipc.c:muk_receive_T:253:after tasksleep 3, p_error=0 
 driver.c:driver_task:143:
RECEIVE: m_source=1, m_type=1027, DEVICE=0, IO_ENDPT=1, POSITION=18B000, COUNT=4096, ADDRESS:5AFBD4, compress(m2_l2):0
 driver.c:driver_task:154:device_caller= 1, rd_mess.m_source= 1
 driver.c:driver_task:177:m_type: 1027 - (DEV_READ= 1027 ? WRITE= 1028)
 driver.c:do_rdwt:287:mp->COUNT=4096
 driver.c:do_rdwt:297:mp->IO_ENDPT=1 - mp->ADDRESS:5AFBD4 - mp->COUNT=4096
 rdisk.c:rd_prepare:228:device = 0 (rd_device = 0)
 rdisk.c:rd_prepare:230:Prepare for I/O on a given minor device: (5330FF4;0), (102400000;0)
 driver.c:do_rdwt:303:mp->m_type: 1027
 driver.c:do_rdwt:323:opcode: 1033 - DEV_GATHER=1033 - DEV_SCATTER=1032
 rdisk.c:rd_transfer:259:rd_device: 0
 rdisk.c:rd_transfer:260:proc_nr=1 opcode=1033 nr_req=1
 utility.c:cv64ul:31:f_cv64ul: 102400000
 rdisk.c:rd_transfer:272:posit: 18B000
 rdisk.c:rd_transfer:273:nr_req: 1
 rdisk.c:rd_transfer:279:count: 4096
 rdisk.c:rd_transfer:283:user_vir 5AFBD4
 utility.c:cv64ul:31:f_cv64ul: 87232500
 rdisk.c:rd_transfer:296:DRIVER - position I/O(mem_phys) 54BBFF4
 rdisk.c:rd_transfer:300:
<DEV_GATHER>
 rdisk.c:rd_transfer:306:bytes: 4096
 rdisk.c:rd_transfer:309:img_ptr=/dev/shm/rdisk.img img_p=3 st_size=102400000 st_blksize=4096 localbuff=5357000 buff_size=4096 active=1 available=1
 rdisk.c:rd_transfer:313:pread: bytes=4096
 rdisk.c:rd_transfer:318:MUK_vcopy 3->1 bytes=4096 
 rdisk.c:rd_transfer:322:DRIVER: MUK_vcopy(DRIVER -> proc_nr) rcode=0
 rdisk.c:rd_transfer:323:bytes= 4096
 rdisk.c:rd_transfer:324:DRIVER - Offset (read) 5357000
 rdisk.c:rd_transfer:325:mem_phys: 5357000 (in DRIVER)
 rdisk.c:rd_transfer:326:user_vir: 5AFBD4 (in proc_nr 1)
 rdisk.c:rd_transfer:339:user_vir (do-buffer) 5B0BD4
 rdisk.c:rd_transfer:342:count=0 stbytes=4096 position=1622016
 rdisk.c:rd_transfer:421:subtotal de bytes
 rdisk.c:rd_transfer:423:subtotal de bytes tbytes=0 nr_req=0
 driver.c:do_rdwt:330:mp->m2_l2 =0, buffer_size=0
 driver.c:do_rdwt:331:dr_trasnfer = (r) 4096
 driver.c:driver_task:249:SEND msg a DEVICE_CALLER: 1 -> m_type=68, (REP_ENDPT)=1, (REP_STATUS)=4096
 task.c:get_task:104:p_ep=3 p_nr=3
 task.c:get_task:113:pproc=50A98F4
 mukipc.c:muk_send_T:120:dst_ep:1 current_ep=3
 mukipc.c:muk_send_T:121:nr=3 id=5 flags=00000000 misc=00000400 p_getfrom=27342 p_sendto=27342 name=rdisk 
 task.c:get_task:104:p_ep=1 p_nr=1
 task.c:get_task:113:pproc=50A98EC
 mukipc.c:muk_send_T:128:nr=1 id=7 flags=00000008 misc=00000400 p_getfrom=3 p_sendto=27342 name=fs 
 mukipc.c:muk_send_T:132:dst_ep:1 WAITING FOR THIS MESSAGE
 mukipc.c:muk_send_T:138:p_rts_flags:0
 rendez.c:_taskwakeup:25:
 rendez.c:_taskwakeup:32:ep=1
 rendez.c:_taskwakeup:35:i=1
 task.c:get_task:104:p_ep=3 p_nr=3
 task.c:get_task:113:pproc=50A98F4
 mukipc.c:muk_receive_T:193:nr=3 id=5 flags=00000000 misc=00000400 p_getfrom=27342 p_sendto=27342 name=rdisk 
 mukipc.c:muk_receive_T:195:src_ep:31438 current_ep=3
 mukipc.c:muk_receive_T:210:NOTIFY PENDING LOOP p_pending=0
 mukipc.c:muk_receive_T:225:Searching for a message
 mukipc.c:muk_receive_T:245:Valid message was not found
 mukipc.c:muk_receive_T:250:nr=3 id=5 flags=00000008 misc=00000400 p_getfrom=31438 p_sendto=27342 name=rdisk 
 mukipc.c:muk_receive_T:251:before tasksleep 3
 rendez.c:tasksleep:9:id=5
 mukipc.c:muk_sendrec_T:516:after tasksleep 1, p_error=0 
 device.c:dev_io:204:BEFORE return dev_mess.REP_STATUS=4096 
 cache.c:rw_block:119:dev_io r=4096, 
 cache.c:put_block:168:
 inode.c:get_inode:41:dev=768 numb=3
 cache.c:put_block:168:
 inode.c:get_inode:75:i_num=3
i_mode=81A4
i_nlinks=1
i_uid=0
i_gid=0
i_dev=768
i_ndzones=7
i_nindirs=1024
 path.c:parse_path:145:Devolviendo rip
 open.c:common_open:131:FD: fs_m_in.fd=0 
 open.c:common_open:132:filp_mode=4 filp_flags=0 filp_count=1 filp_pos=0 filp_selectors=0 filp_select_ops=0 filp_pipe_select_ops=0
 open.c:common_open:134:exist=1 
 protect.c:forbidden:186:access_desired=4 
 protect.c:forbidden:187:perm_bits=6 perm_bits(OCT)=06
 protect.c:forbidden:188:access_desired=4 access_desired(OCT)=04
 protect.c:forbidden:203:r=0
 open.c:common_open:140:r forbidden = 0
 open.c:common_open:145: I_REGULAR
 open.c:common_open:225:fs_m_in.fd=0 
 fs.c:main_fs:104:rcode (RESPUESTA syscall) 0
 fs.c:fs_reply:415:Send a fs_reply to a user process.
 fs.c:fs_reply:419:source=0 type=0 m1i1=0 m1i2=0 m1i3=0 m1p1=(nil) m1p2=(nil) m1p3=(nil) 
 task.c:get_task:104:p_ep=1 p_nr=1
 task.c:get_task:113:pproc=50A98EC
 mukipc.c:muk_send_T:120:dst_ep:14 current_ep=1
 mukipc.c:muk_send_T:121:nr=1 id=7 flags=00000000 misc=00000400 p_getfrom=27342 p_sendto=27342 name=fs 
 task.c:get_task:104:p_ep=14 p_nr=14
 task.c:get_task:113:pproc=50A9920
 mukipc.c:muk_send_T:128:nr=14 id=11 flags=00000008 misc=00000400 p_getfrom=1 p_sendto=27342 name=m3ftp 
 mukipc.c:muk_send_T:132:dst_ep:14 WAITING FOR THIS MESSAGE
 mukipc.c:muk_send_T:138:p_rts_flags:0
 rendez.c:_taskwakeup:25:
 rendez.c:_taskwakeup:32:ep=14
 rendez.c:_taskwakeup:35:i=1
 fs.c:fs_reply:422:rcode=0
 fs.c:fs_get_work:155: LISTENING . 
 task.c:get_task:104:p_ep=1 p_nr=1
 task.c:get_task:113:pproc=50A98EC
 mukipc.c:muk_receive_T:193:nr=1 id=7 flags=00000000 misc=00000400 p_getfrom=27342 p_sendto=27342 name=fs 
 mukipc.c:muk_receive_T:195:src_ep:31438 current_ep=1
 mukipc.c:muk_receive_T:210:NOTIFY PENDING LOOP p_pending=0
 mukipc.c:muk_receive_T:225:Searching for a message
 mukipc.c:muk_receive_T:245:Valid message was not found
 mukipc.c:muk_receive_T:250:nr=1 id=7 flags=00000008 misc=00000400 p_getfrom=31438 p_sendto=27342 name=fs 
 mukipc.c:muk_receive_T:251:before tasksleep 1
 rendez.c:tasksleep:9:id=7
 mukipc.c:muk_sendrec_T:516:after tasksleep 14, p_error=0 
 m3ftpd.c:main_ftpd:198:M3FTPD: READ LOOP
DEBUG 21:dvk_receive_T:834: endpoint=15 timeout=0
DEBUG 21:dvk_receive_T:838: ipc ret=-1
ERROR: 21:dvk_receive_T:857: rcode=-1
ERROR: m3ftpd.c:main_ftpd:205: rcode=-11
 m3ftpd.c:main_ftpd:236:M3FTPD: CLOSE 
 mol_close.c:mol_close:7:fd=0
 task.c:get_task:104:p_ep=14 p_nr=14
 task.c:get_task:113:pproc=50A9920
 mukipc.c:muk_sendrec_T:483:nr=14 id=11 flags=00000000 misc=00000400 p_getfrom=27342 p_sendto=27342 name=m3ftp 
 mukipc.c:muk_sendrec_T:485:srcdst_ep:1
 task.c:get_task:104:p_ep=1 p_nr=1
 task.c:get_task:113:pproc=50A98EC
 mukipc.c:muk_sendrec_T:491:nr=1 id=7 flags=00000008 misc=00000400 p_getfrom=31438 p_sendto=27342 name=fs 
 mukipc.c:muk_sendrec_T:498:SENDING HALF
 mukipc.c:muk_sendrec_T:504:destination is waiting. Copy the message and wakeup destination
 rendez.c:_taskwakeup:25:
 rendez.c:_taskwakeup:32:ep=1
 rendez.c:_taskwakeup:35:i=1
 mukipc.c:muk_sendrec_T:513:nr=14 id=11 flags=00000008 misc=00000400 p_getfrom=1 p_sendto=27342 name=m3ftp 
 mukipc.c:muk_sendrec_T:514:before tasksleep 14
 rendez.c:tasksleep:9:id=11
 mukipc.c:muk_receive_T:253:after tasksleep 1, p_error=0 
 fs.c:fs_get_work:159:source=14 type=6 m1i1=0 m1i2=0 m1i3=0 m1p1=(nil) m1p2=(nil) m1p3=(nil) 
 fs.c:fs_get_work:160:source=14 type=6 m3i1=0 m3i2=0 m3p1=(nil) m3ca1=[]
 fs.c:fs_get_work:182:fs_call_nr = 6 
 open.c:fs_close:406:
 filedes.c:get_filp:75:fild is=0
 fs.c:main_fs:104:rcode (RESPUESTA syscall) 0
 fs.c:fs_reply:415:Send a fs_reply to a user process.
 fs.c:fs_reply:419:source=0 type=0 m1i1=0 m1i2=0 m1i3=0 m1p1=(nil) m1p2=(nil) m1p3=(nil) 
 task.c:get_task:104:p_ep=1 p_nr=1
 task.c:get_task:113:pproc=50A98EC
 mukipc.c:muk_send_T:120:dst_ep:14 current_ep=1
 mukipc.c:muk_send_T:121:nr=1 id=7 flags=00000000 misc=00000400 p_getfrom=27342 p_sendto=27342 name=fs 
 task.c:get_task:104:p_ep=14 p_nr=14
 task.c:get_task:113:pproc=50A9920
 mukipc.c:muk_send_T:128:nr=14 id=11 flags=00000008 misc=00000400 p_getfrom=1 p_sendto=27342 name=m3ftp 
 mukipc.c:muk_send_T:132:dst_ep:14 WAITING FOR THIS MESSAGE
 mukipc.c:muk_send_T:138:p_rts_flags:0
 rendez.c:_taskwakeup:25:
 rendez.c:_taskwakeup:32:ep=14
 rendez.c:_taskwakeup:35:i=1
 fs.c:fs_reply:422:rcode=0
 fs.c:fs_get_work:155: LISTENING . 
 task.c:get_task:104:p_ep=1 p_nr=1
 task.c:get_task:113:pproc=50A98EC
 mukipc.c:muk_receive_T:193:nr=1 id=7 flags=00000000 misc=00000400 p_getfrom=27342 p_sendto=27342 name=fs 
 mukipc.c:muk_receive_T:195:src_ep:31438 current_ep=1
 mukipc.c:muk_receive_T:210:NOTIFY PENDING LOOP p_pending=0
 mukipc.c:muk_receive_T:225:Searching for a message
 mukipc.c:muk_receive_T:245:Valid message was not found
 mukipc.c:muk_receive_T:250:nr=1 id=7 flags=00000008 misc=00000400 p_getfrom=31438 p_sendto=27342 name=fs 
 mukipc.c:muk_receive_T:251:before tasksleep 1
 rendez.c:tasksleep:9:id=7
 mukipc.c:muk_sendrec_T:516:after tasksleep 14, p_error=0 
ERROR: m3ftpd.c:main_ftpd:239: rcode=-11
 m3ftpd.c:ftpd_reply:26:ftpd_reply=-11
 task.c:get_task:104:p_ep=14 p_nr=14
 task.c:get_task:113:pproc=50A9920
 mukipc.c:muk_send_T:120:dst_ep:15 current_ep=14
 mukipc.c:muk_send_T:121:nr=14 id=11 flags=00000000 misc=00000400 p_getfrom=27342 p_sendto=27342 name=m3ftp 
 task.c:get_task:104:p_ep=15 p_nr=15
muk2: mukipc.c:127: muk_send_T: Assertion `dst_ptr != NULL' failed.
./muk2.sh: lÃ­nea 6:  1775 Abortado                nsenter -p -t $DC0 ./muk2 muk.cfg
root@node0:/usr/src/dvs/vos/muk2# 



		CLIENT 
	root@node0:/usr/src/dvs/vos/muk2/servers/m3ftp# nsenter -p -t $DC0 ./m3ftp -g 0 file10M.txt file10M.out
 m3ftp.c:main:158:M3FTP argc=5
 m3ftp.c:main:163:M3FTP dcid=0
 m3ftp.c:main:166:M3FTP ftpd_ep=14
 m3ftp.c:ftp_init:58:ftp_lpid=22
DEBUG 22:dvk_open:102: 
DEBUG 22:dvk_bind_X:1137: cmd=0 dcid=0 pid=-1 endpoint=15 nodeid=-1
DEBUG 22:dvk_bind_X:1141: ipc ret=15
 m3ftp.c:ftp_init:76:rcode=15
DEBUG 22:dvk_getep:217: pid=22
DEBUG 22:dvk_getep:221: ipc ret=15
 m3ftp.c:ftp_init:120:M3FTP m_ptr=0x16e5000
 m3ftp.c:ftp_init:127:M3FTP path_ptr=0x16e6000
 m3ftp.c:ftp_init:134:M3FTP data_ptr=0x16e7000
 m3ftp.c:main:174:M3FTP new cwd=/usr/src/dvs/vos/muk2/servers/m3ftp
 m3ftp.c:main:198:oper=1
 m3ftp.c:main:200:M3FTP: file10M.txt
 m3ftp.c:main:201:M3FTP: request source=0 type=1 m1i1=11 m1i2=0 m1i3=0 m1p1=0xbfa58e21 m1p2=(nil) m1p3=(nil) 
DEBUG 22:dvk_sendrec_T:866: endpoint=14 timeout=-1
DEBUG 22:dvk_sendrec_T:870: ipc ret=0
 m3ftp.c:main:204:M3FTP: reply source=14 type=0 m1i1=11 m1i2=0 m1i3=0 m1p1=0xbfa58e21 m1p2=(nil) m1p3=(nil) 
 m3ftp.c:main:237:M3FTP FTP_GET file10M.txt->file10M.out
 m3ftp.c:main:245:M3FTP: request source=14 type=3 m1i1=11 m1i2=65536 m1i3=0 m1p1=0xbfa58e21 m1p2=0x16e7000 m1p3=(nil) 
DEBUG 22:dvk_sendrec_T:866: endpoint=14 timeout=-1
DEBUG 22:dvk_sendrec_T:870: ipc ret=-1
ERROR: 22:dvk_sendrec_T:888: rcode=-1
ERROR: m3ftp.c:main:247: rcode=-1
 m3ftp.c:main:266:M3FTP: CLOSE
t_start=1569890769.77 t_stop=1569890771.25 t_total=1.48
total_bytes = 0
Throuhput = 0.000000 [bytes/s]
ERROR: m3ftp.c:main:275: rcode=-1



=====================================================================================================
20191001:	modificaciones a M3FTPD	

SERVER 
 read.c:rw_chunk:348:MUK_vcopy 1->14 bytes=4096 
 read.c:rw_chunk:349:Resultado muk_vcopy SERVIDOR -> CLIENTE 0
 read.c:rw_chunk:350:chunk 4096
 cache.c:put_block:168:
 read.c:read_write:262:cum_io=65536
 fs.c:main_fs:104:rcode (RESPUESTA syscall) 65536
 fs.c:fs_reply:415:Send a fs_reply to a user process.
 fs.c:fs_reply:419:source=0 type=65536 m1i1=0 m1i2=0 m1i3=0 m1p1=(nil) m1p2=(nil) m1p3=(nil) 
 task.c:get_task:104:p_ep=1 p_nr=1
 task.c:get_task:113:pproc=4FFA8EC
 mukipc.c:muk_send_T:120:dst_ep:14 current_ep=1
 mukipc.c:muk_send_T:121:nr=1 id=7 flags=00000000 misc=00000400 p_getfrom=27342 p_sendto=27342 name=fs 
 task.c:get_task:104:p_ep=14 p_nr=14
 task.c:get_task:113:pproc=4FFA920
 mukipc.c:muk_send_T:128:nr=14 id=11 flags=00000008 misc=00000400 p_getfrom=1 p_sendto=27342 name=m3ftp 
 mukipc.c:muk_send_T:132:dst_ep:14 WAITING FOR THIS MESSAGE
 mukipc.c:muk_send_T:138:p_rts_flags:0
 rendez.c:_taskwakeup:25:
 rendez.c:_taskwakeup:32:ep=14
 rendez.c:_taskwakeup:35:i=1
 fs.c:fs_reply:422:rcode=0
 fs.c:fs_get_work:155: LISTENING . 
 task.c:get_task:104:p_ep=1 p_nr=1
 task.c:get_task:113:pproc=4FFA8EC
 mukipc.c:muk_receive_T:193:nr=1 id=7 flags=00000000 misc=00000400 p_getfrom=27342 p_sendto=27342 name=fs 
 mukipc.c:muk_receive_T:195:src_ep:31438 current_ep=1
 mukipc.c:muk_receive_T:210:NOTIFY PENDING LOOP p_pending=0
 mukipc.c:muk_receive_T:225:Searching for a message
 mukipc.c:muk_receive_T:245:Valid message was not found
 mukipc.c:muk_receive_T:250:nr=1 id=7 flags=00000008 misc=00000400 p_getfrom=31438 p_sendto=27342 name=fs 
 mukipc.c:muk_receive_T:251:before tasksleep 1
 rendez.c:tasksleep:9:id=7
 mukipc.c:muk_sendrec_T:516:after tasksleep 14, p_error=0 
 mol_read.c:mol_read:16:return 65536
 m3ftpd.c:main_ftpd:208:M3FTPD: FTPDLEN=65536 rlen=65536
DEBUG 4:dvk_vcopy:122: src_ep=14 dst_ep=15 bytes=65536
DEBUG 4:dvk_vcopy:126: ipc ret=65536
DEBUG 4:dvk_send_T:803: endpoint=15 timeout=0
DEBUG 4:dvk_send_T:807: ipc ret=76
DEBUG 4:dvk_receive_T:834: endpoint=15 timeout=0
DEBUG 4:dvk_receive_T:838: ipc ret=-1
ERROR: 4:dvk_receive_T:857: rcode=-1
ERROR: m3ftpd.c:main_ftpd:203: rcode=-11  
 m3ftpd.c:main_ftpd:234:M3FTPD: CLOSE 
 mol_close.c:mol_close:7:fd=0
 task.c:get_task:104:p_ep=14 p_nr=14
 task.c:get_task:113:pproc=4FFA920
 mukipc.c:muk_sendrec_T:483:nr=14 id=11 flags=00000000 misc=00000400 p_getfrom=27342 p_sendto=27342 name=m3ftp 
 mukipc.c:muk_sendrec_T:485:srcdst_ep:1
 task.c:get_task:104:p_ep=1 p_nr=1
 task.c:get_task:113:pproc=4FFA8EC
 mukipc.c:muk_sendrec_T:491:nr=1 id=7 flags=00000008 misc=00000400 p_getfrom=31438 p_sendto=27342 name=fs 
 mukipc.c:muk_sendrec_T:498:SENDING HALF
 mukipc.c:muk_sendrec_T:504:destination is waiting. Copy the message and wakeup destination
 rendez.c:_taskwakeup:25:
 rendez.c:_taskwakeup:32:ep=1
 rendez.c:_taskwakeup:35:i=1
 mukipc.c:muk_sendrec_T:513:nr=14 id=11 flags=00000008 misc=00000400 p_getfrom=1 p_sendto=27342 name=m3ftp 
 mukipc.c:muk_sendrec_T:514:before tasksleep 14
 rendez.c:tasksleep:9:id=11
 mukipc.c:muk_receive_T:253:after tasksleep 1, p_error=0 
 fs.c:fs_get_work:159:source=14 type=6 m1i1=0 m1i2=0 m1i3=0 m1p1=(nil) m1p2=(nil) m1p3=(nil) 
 fs.c:fs_get_work:160:source=14 type=6 m3i1=0 m3i2=0 m3p1=(nil) m3ca1=[]
 fs.c:fs_get_work:182:fs_call_nr = 6 
 open.c:fs_close:406:
 filedes.c:get_filp:75:fild is=0
 cache.c:put_block:168:
 fs.c:main_fs:104:rcode (RESPUESTA syscall) 0
 fs.c:fs_reply:415:Send a fs_reply to a user process.
 fs.c:fs_reply:419:source=0 type=0 m1i1=0 m1i2=0 m1i3=0 m1p1=(nil) m1p2=(nil) m1p3=(nil) 
 task.c:get_task:104:p_ep=1 p_nr=1
 task.c:get_task:113:pproc=4FFA8EC
 mukipc.c:muk_send_T:120:dst_ep:14 current_ep=1
 mukipc.c:muk_send_T:121:nr=1 id=7 flags=00000000 misc=00000400 p_getfrom=27342 p_sendto=27342 name=fs 
 task.c:get_task:104:p_ep=14 p_nr=14
 task.c:get_task:113:pproc=4FFA920
 mukipc.c:muk_send_T:128:nr=14 id=11 flags=00000008 misc=00000400 p_getfrom=1 p_sendto=27342 name=m3ftp 
 mukipc.c:muk_send_T:132:dst_ep:14 WAITING FOR THIS MESSAGE
 mukipc.c:muk_send_T:138:p_rts_flags:0
 rendez.c:_taskwakeup:25:
 rendez.c:_taskwakeup:32:ep=14
 rendez.c:_taskwakeup:35:i=1
 fs.c:fs_reply:422:rcode=0
 fs.c:fs_get_work:155: LISTENING . 
 task.c:get_task:104:p_ep=1 p_nr=1
 task.c:get_task:113:pproc=4FFA8EC
 mukipc.c:muk_receive_T:193:nr=1 id=7 flags=00000000 misc=00000400 p_getfrom=27342 p_sendto=27342 name=fs 
 mukipc.c:muk_receive_T:195:src_ep:31438 current_ep=1
 mukipc.c:muk_receive_T:210:NOTIFY PENDING LOOP p_pending=0
 mukipc.c:muk_receive_T:225:Searching for a message
 mukipc.c:muk_receive_T:245:Valid message was not found
 mukipc.c:muk_receive_T:250:nr=1 id=7 flags=00000008 misc=00000400 p_getfrom=31438 p_sendto=27342 name=fs 
 mukipc.c:muk_receive_T:251:before tasksleep 1
 rendez.c:tasksleep:9:id=7
 mukipc.c:muk_sendrec_T:516:after tasksleep 14, p_error=0 
ERROR: m3ftpd.c:main_ftpd:237: rcode=-11
 m3ftpd.c:ftpd_reply:24:ftpd_reply=-11
DEBUG 4:dvk_send_T:803: endpoint=15 timeout=0
DEBUG 4:dvk_send_T:807: ipc ret=-1
ERROR: 4:dvk_send_T:825: rcode=-1
 m3ftpd.c:ftpd_reply:29:M3FTPD: ftpd_reply rcode=-11
DEBUG 4:dvk_receive_T:834: endpoint=31438 timeout=0
DEBUG 4:dvk_receive_T:838: ipc ret=0
 m3ftpd.c:main_ftpd:145:M3FTPD: muk_receive_T  rcode=0
 m3ftpd.c:main_ftpd:152:M3FTPD: source=15 type=3 m1i1=11 m1i2=65536 m1i3=0 m1p1=0xbfe62e31 m1p2=0x1e2b000 m1p3=(nil) 
M3FTPD: invalid request 3
 m3ftpd.c:ftpd_reply:24:ftpd_reply=-22


CLIENT 
	< m3ftp.c:main:245:M3FTP: request source=14 type=3 m1i1=11 m1i2=65536 m1i3=0 m1p1=0xbfe62e31 m1p2=0x1e2b000 m1p3=(nil) 
	DEBUG 5:dvk_sendrec_T:866: endpoint=14 timeout=-1
	DEBUG 5:dvk_sendrec_T:870: ipc ret=0
	 m3ftp.c:main:248:M3FTP: reply   source=14 type=0 m1i1=11 m1i2=65536 m1i3=0 m1p1=0xbfe62e31 m1p2=0x1e2b000 m1p3=(nil) 
	< m3ftp.c:main:245:M3FTP: request source=14 type=3 m1i1=11 m1i2=65536 m1i3=0 m1p1=0xbfe62e31 m1p2=0x1e2b000 m1p3=(nil) 
	DEBUG 5:dvk_sendrec_T:866: endpoint=14 timeout=-1
	DEBUG 5:dvk_sendrec_T:870: ipc ret=0
	 m3ftp.c:main:248:M3FTP: reply   source=14 type=-22 m1i1=11 m1i2=65536 m1i3=0 m1p1=0xbfe62e31 m1p2=0x1e2b000 m1p3=(nil) 
	ERROR: m3ftp.c:main:251: rcode=-22
	 m3ftp.c:main:266:M3FTP: CLOSE
	t_start=1569973354.39 t_stop=1569973359.38 t_total=4.98
	total_bytes = 262144
	Throuhput = 52629.339135 [bytes/s]
	ERROR: m3ftp.c:main:275: rcode=-22
	
	El type=3 es FTP_NEXT	3
	
=====================================================================================================
20191006:	Correccion de errores en el GET error -22 

	se corrigieron las macros 
		}while(r == EDVSAGAIN);\ <<<< antes decia 	}while(r != EDVSAGAIN);\

	enviando SIGQUIT a MUK2 se ven los procesos ejecutando 
	
	task list:
    11  m3ftp                sleep
     2                       
     3  systask              sleep
     4s fdtask               poll (running)
     5  rdisk                sleep
     6  pm                   sleep
     7  fs                   sleep
     8  is                   sleep
     9                       fdwait for read
    10  nweb                 fdwait for read



	PROBLEMA: 	
				El  GET funciona OK
				El PUT no escribe 
				problema con el calculo de throughput en FTPD 
					t_start=172701.00 t_stop=185327.00 t_total=12626.00
					total_bytes = 0
					Throuhput = 0.000000 [bytes/s]
					t_start=660174.00 t_stop=682603.00 t_total=22429.00
					total_bytes = 25615
					Throuhput = 1.142048 [bytes/s]
					t_start=748918.00 t_stop=891005.00 t_total=142087.00
					total_bytes = 1474560
					Throuhput = 10.377867 [bytes/s]
					t_start=181583.00 t_stop=404276.00 t_total=222693.00
					total_bytes = 1474560
					Throuhput = 6.621492 [bytes/s]
					t_start=272798.00 t_stop=280052.00 t_total=7254.00 <<<<<<<<
					total_bytes = 25615
					Throuhput = 3.531155 [bytes/s]
					t_start=852465.00 t_stop=360554.00 t_total=-491911.00 <<<<<<<<<
					total_bytes = 10485760
					Throuhput = -21.316376 [bytes/s]
		
=====================================================================================================
20191008:		Se modifico la forma en que se pueden utilizar las primitivas del DVK desde procesos MUK2_RETURN
				Ahora, cada vez que se hace un muk_bind 
					- se pide memoria para almacenar una estructura proc_usr_t igual que en el kernel
					- esta estructura esta apuntada desde la tarea.
					- cada tarea tiene asociada una estructura dvk_request_t
					- se crea un thread por cada task bindeada el cual se bindea en el DVK !! (no en MUK2) con el mismo endpoint que la tarea. 
					- el thread queda bloqueado hasta que la tarea le hace un PH_MTX_LOCK para distingirlo de MTX_LOCK que lo hace para tareas.
					- Luego el thread entre en un loop infinito esperando que la tarea padre lo despierte porque tiene que procesar un request.
					- la tarea padre completa la estructura dvk_request_t y hace un PH_COND_SIGNAL para despertar al thread
					- el thread hace SEND, RECEIVE, SENDREC, NOTIFY y VCOPY 
					- cuando finaliza hace un KILL SIGIO hacia el thread principal
					- La signal handler hace un wakeup de la tarea correspondiente.
		
	
=====================================================================================================
20191010:		Se creo una cola de peticiones entre las tareas MUK y los threads que atienden DVK IPC 

DEBUG 2:dvk_bind_X:1137: cmd=0 dcid=0 pid=9 endpoint=14 nodeid=-1
DEBUG 2:dvk_bind_X:1141: ipc ret=-1
ERROR: task.c:pth_dvk:203: rcode=337
ERROR: task.c:pth_dvk:205: rcode=-1

#define EDVSSLOTUSED 	 (_SIGN 337)  	/* BIND the slot is already used */

PARA MI, EL M3FTPD HACE UN PM_BIND QUE TRATA DE HACER EL BIND O ALGO ASI
Y YA ENCUENTRA EL SLOT USADO

st_bindproc.c:st_bindproc:53:source=0 type=1568 m3i1=11 m3i2=14 m3p1=0x1 m3ca1=[ftpd]
 st_bindproc.c:st_bindproc:59:sysproc_lpid=11, sysproc_ep=14 sysproc_nr=14 sysproc_oper=1 
 task.c:get_task:330:p_ep=14 p_nr=14
 task.c:get_task:339:pproc=501B9C0
 task.c:get_task:330:p_ep=14 p_nr=14
 task.c:get_task:339:pproc=501B9C0

 ESTO ESTA MAL !!! 
 st_bindproc.c:st_bindproc:75:nr=97734880 endp=-1269695680 dcid=0 flags=0 misc=0 lpid=0 vpid=0 nodeid=0 name= 
 task.c:get_task:330:p_ep=14 p_nr=14
 task.c:get_task:339:pproc=501B9C0

 ESTO ESTA MAL !!! 
 st_bindproc.c:st_bindproc:151:nr=97734880 endp=-1269695680 dcid=0 flags=0 misc=0 lpid=0 vpid=0 nodeid=0 name= 
 st_bindproc.c:st_bindproc:159:nr=97734880 endp=-1269695680 dcid=0 flags=0 misc=0 lpid=0 vpid=0 nodeid=0 name= 
 system.c:main_systask:100:REPLY msg:source=0 type=0 m1i1=14 m1i2=1 m1i3=1 m1p1=0x64707466 m1p2=(nil) m1p3=(nil) 
 task.c:get_task:330:p_ep=-2 p_nr=-2
 task.c:get_task:339:pproc=501B980
 mukipc.c:muk_send_T:151:dst_ep:0 current_ep=-2
 mukipc.c:muk_send_T:153:nr=-2 endp=-2 dcid=0 flags=0 misc=400 lpid=2 vpid=3 nodeid=0 name=systask 
 task.c:get_task:330:p_ep=0 p_nr=0
 task.c:get_task:339:pproc=501B988


ERROR: task.c:pth_dvk:203: rcode=2
task list:
     1  taskmain             sleep
     2  U‰åSƒìè=|üÿÃ]l    
     3  systask              sleep
     4s fdtask               poll (running)
     5  rdisk                sleep
     6  pm                   sleep
     7  fs                   sleep
     8  is                   sleep
	 

 m3ftpd.c:main_ftpd:139:MTX_LOCK muk_mutex:1
 m3ftpd.c:main_ftpd:140:MTX_UNLOCK muk_mutex:1
 task.c:DVK_receive_T:93:nr=14 endp=14 dcid=0 flags=0 misc=400 lpid=2 vpid=9 nodeid=0 name=ftpd 
 task.c:DVK_receive_T:101:PH_MTX_LOCK t->p_mutex 
 task.c:DVK_receive_T:102:PH_COND_SIGNAL t->p_th_cond
 task.c:DVK_receive_T:103:PH_COND_WAIT t->p_tsk_cond t->p_mutex
 task.c:pth_dvk:215:PH_COND_SIGNAL t->p_tsk_cond
 task.c:pth_dvk:216:PH_MTX_UNLOCK t->p_mutex 
 task.c:pth_dvk:218:11: id=11 rq_oper=2 rq_other_ep=5255879 rq_timeout=5504480
DEBUG 2:dvk_receive_T:834: endpoint=5255879 timeout=5504480
 task.c:DVK_receive_T:104:PH_MTX_UNLOCK t->p_mutex 
 rendez.c:tasksleep:9:id=11
DEBUG 2:dvk_receive_T:838: ipc ret=-1 <<<<<<<<<<<<<<<<<<<< 
 task.c:pth_dvk:244:PH_MTX_LOCK rqst_mutex 
 task.c:pth_dvk:246:PH_MTX_UNLOCK rqst_mutex 
 
 [  128.480722] ERROR: 683:ipc_mini_receive:335: rcode=-34
 
[  128.480952] muk2[683]: segfault at 6a ip b77a9e16 sp b456a310 error 4 in libpthread-2.24.so[b779d000+19000]

=====================================================================================================
20191011:
		
		
	root@node0:~# cat /proc/dvs/DC0/procs 
	DC pnr -endp -lpid/vpid- nd flag misc -getf -sndt -wmig -prxy name
	 0  -2    -2   695/3      0    0   20 27342 27342 27342 27342 muk2           
	 0   0     0   697/5      0    0    0 27342 27342 27342 27342 muk2           
	 0   1     1   698/6      0    0    0 27342 27342 27342 27342 muk2           
	 0   3     3   696/4      0    0    0 27342 27342 27342 27342 muk2           
	 0   8     8   699/7      0    0    0 27342 27342 27342 27342 muk2           
	 0  14    14   713/9      0    8    0 31438 27342 27342 27342 muk2           
	 0  22    22   702/8      0    0    0 27342 27342 27342 27342 muk2           
	root@node0:~# cat /proc/dvs/DC0/procs 
	DC pnr -endp -lpid/vpid- nd flag misc -getf -sndt -wmig -prxy name
	 0  14    14   713/9      0    0    0 27342 27342 27342 27342 muk2   
 
 		 
[   85.331661] Started in network mode
[   85.331667] Own node address <1.1.100>, network identity 4711
[   85.334609] Enabled bearer <eth:eth0>, discovery domain <1.1.0>, priority 10
[  122.357224] ERROR: 694:check_caller:579: rcode=-310
[  122.357741] ERROR: 694:check_caller:579: rcode=-310
[  160.711687] ERROR: 713:ipc_mini_receive:500: rcode=-61 <<<< EDVSTIMEDOUT 
[  160.711881] muk2[713]: segfault at 6a ip b76cde16 sp b448e310 error 4 in libpthread-2.24.so[b76c1000+19000]


		713 es M3FTPD porque tiene el endpoint 14

	  mukipc.c:muk_timeout_task:106:timeout_task->p_timeout=-1
	 mukipc.c:muk_timeout_task:106:timeout_task->p_timeout=-1
	 mukipc.c:muk_timeout_task:106:timeout_task->p_timeout=-1
	 mukipc.c:muk_timeout_task:106:timeout_task->p_timeout=-1
	DEBUG 2:dvk_receive_T:838: ipc ret=-1
	 task.c:pth_dvk:249:PH_MTX_LOCK rqst_mutex 
 
 		PH_MTX_LOCK(rqst_mutex); <<<<<<<<<<<<<<<<<<<<<<<<< ESTE LO HACE BIEN 
		TAILQ_INSERT_TAIL(&rqst_head, t, p_entries); <<<<< AQUI PUEDE ESTAR EL PROBLEMA 
		pthread_kill(t->pid, SIGIO);				 <<<<< AQUI PUEDE ESTAR EL PROBLEMA 
		PH_MTX_UNLOCK(rqst_mutex);
		
 --------------------------------------------------------------
ANULANDO EL MANEJO DE COLAS SIGUE PASANDO ========>> PROBLEMA CON EL pthread_kill(t->pid, SIGIO); 
 root@node0:~# dmesg
[   33.403484] Started in network mode
[   33.403490] Own node address <1.1.100>, network identity 4711
[   33.407276] Enabled bearer <eth:eth0>, discovery domain <1.1.0>, priority 10
[   62.179785] ERROR: 695:check_caller:579: rcode=-310
[   62.180322] ERROR: 695:check_caller:579: rcode=-310
[   99.306941] ERROR: 714:ipc_mini_receive:500: rcode=-61
[   99.307237] muk2[714]: segfault at 6a ip b76c1e16 sp b4482310 error 4 in libpthread-2.24.so[b76b5000+19000]
root@node0:~# 

--------------------------------------------------------------
ANULANDO EL KILL 

root@node0:~# dmesg
[   45.560277] Started in network mode
[   45.560284] Own node address <1.1.100>, network identity 4711
[   45.563480] Enabled bearer <eth:eth0>, discovery domain <1.1.0>, priority 10
[   46.058531] ERROR: 656:check_caller:579: rcode=-310
[   75.563898] ERROR: 694:check_caller:579: rcode=-310
[   75.564413] ERROR: 694:check_caller:579: rcode=-310
[  113.647389] ERROR: 703:ipc_mini_receive:500: rcode=-61 <<<<< VENDIO EL TIMEOUT 

root@node0:~# cat /proc/dvs/DC0/procs 
DC pnr -endp -lpid/vpid- nd flag misc -getf -sndt -wmig -prxy name
 0  -2    -2   695/3      0    0   20 27342 27342 27342 27342 muk2           
 0   0     0   697/5      0    0    0 27342 27342 27342 27342 muk2           
 0   1     1   698/6      0    0    0 27342 27342 27342 27342 muk2           
 0   3     3   696/4      0    0    0 27342 27342 27342 27342 muk2           
 0   8     8   699/7      0    0    0 27342 27342 27342 27342 muk2           
 0  14    14   703/9      0    0    0 27342 27342 27342 27342 muk2           
 0  22    22   700/8      0    0    0 27342 27342 27342 27342 muk2  
 
 NO SE FALLA, (pero no ejecuta el SIGNAL HANDLER !!
 
 
 TODO: Hacer una tarea en el ciclo de libtask que haga
		PH_MUTEX_UNLOCK();
		
		PH_MUTEX_UNLOCK();
		Para que le de tiempo de ejecucion a los threads que necesitan acceder 
		
TODO:
	Usar int pthread_sigmask(int how, const sigset_t *set, sigset_t *oldset);
	
	
MODIFICAR EL SCHEDULER 

static void
taskscheduler(void)
{
	int i;
	Task *t;

	taskdebug("scheduler enter");
	
	for(;;){
		if(taskcount == 0)
			exit(taskexitval);
			
		PH_MTX_LOCK(muk2_mutex);
		if( dvk_bitmap != 0)
			dvk_wakeup_tasks();
		PH_MTX_UNLOCK(muk2_mutex);
		
		t = taskrunqueue.head;
		if(t == nil){
			fprint(2, "no runnable tasks! %d tasks stalled\n", taskcount);
			exit(1);
		}
		deltask(&taskrunqueue, t);
		t->ready = 0;
		taskrunning = t;
		tasknswitch++;
		taskdebug("run %d (%s)", t->id, t->name);
		contextswitch(&taskschedcontext, &t->context);
//print("back in scheduler\n");
		taskrunning = nil;
		if(t->exiting){
			if(!t->system)
				taskcount--;
			i = t->alltaskslot;
			alltask[i] = alltask[--nalltask];
			alltask[i]->alltaskslot = i;
			free(t);
		}
	}
}
	
=====================================================================================================
20191013/14:  IMPLEMENTACION DE TIMEOUT EN MUK_xXXXXXX

			FUNCIONO  OK!
			
			DC pnr -endp -lpid/vpid- nd flag misc -getf -sndt -wmig -prxy name
			 0  -2    -2   703/3      0    0   20 27342 27342 27342 27342 muk2           
			 0   0     0   705/5      0    0    0 27342 27342 27342 27342 muk2           
			 0   1     1   706/6      0    0    0 27342 27342 27342 27342 muk2           
			 0   3     3   704/4      0    0    0 27342 27342 27342 27342 muk2           
			 0   8     8   708/7      0    0    0 27342 27342 27342 27342 muk2           
			 0  14    14   711/9      0    8    0 31438 27342 27342 27342 muk2           
			 0  22    22   709/8      0    0    0 27342 27342 27342 27342 muk2 
 
ERROR:
		[  904.219047] ERROR: 711:ipc_mini_receive:500: rcode=-61
		[  908.855693] muk2[702]: segfault at 7 ip b75d4d86 sp 06a58ebc error 4 in libc-2.24.so[b755f000+1b1000]
		[  908.860285] ERROR: 711:ipc_mini_receive:500: rcode=-512


			ERROR: 2:dvk_receive_T:857: rcode=-1
			ERROR: task.c:pth_dvk:243: rcode=-61
			ERROR: task.c:DVK_receive_T:106: rcode=-61
			ERROR: open.c:common_open:119: rcode=-2      <<<<<<<<<<<<<<<<<< EDVSNOENT
			ERROR: m3nweb.c:nweb_server:227: rcode=-2    <<<<<<<<<<<<<<<<<< EDVSNOENT 
			ERROR: 2:dvk_receive_T:857: rcode=-1
			ERROR: task.c:pth_dvk:243: rcode=-61
			ERROR: task.c:DVK_receive_T:106: rcode=-61

			M3NWEB -> FS 
			 fs.c:fs_get_work:159:source=22 type=5 m1i1=12 m1i2=0 m1i3=111308805 m1p1=0x69766166 m1p2=0x2e6e6f63 m1p3=0x6f6369 
			 fs.c:fs_get_work:160:source=22 type=5 m3i1=12 m3i2=0 m3p1=0x6a27005 m3ca1=[favicon.ico]
			 fs.c:fs_get_work:182:fs_call_nr = 5 
			 open.c:fs_open:67:M3
			 utility.c:fetch_name:130:fs_who_e=22 path=6A27005 len=12 flag=3
			 utility.c:fetch_name:142:M3=3
			 utility.c:fetch_name:143:M3_STRING=14
			 utility.c:fetch_name:157:user_path=favicon.ico
			 open.c:common_open:96:oflags=0 omode=0
			 filedes.c:get_fd:33:start=0 mode=4
			 filedes.c:get_fd:39:FD located is=0
			 open.c:common_open:102:fs_m_in.fd=0 oflags=0 
			 open.c:common_open:118:user_path=favicon.ico
			 path.c:parse_path:47:path=favicon.ico string=(null) action=0 
			 path.c:parse_path:55:RELATIVE: fp_endpoint=22 i_num=1
			 inode.c:dup_inode:380:
			 path.c:parse_path:98:string = favicon.ico
			 protect.c:forbidden:186:access_desired=1 
			 protect.c:forbidden:187:perm_bits=7 perm_bits(OCT)=07
			 protect.c:forbidden:188:access_desired=1 access_desired(OCT)=01
			 protect.c:forbidden:203:r=0
			 read.c:read_map:396:position=0
			 cache.c:put_block:168:
			 path.c:parse_path:105:NIL_INODE = (null)
			 path.c:parse_path:110:There is more path.  Keep parsing
			 fs.c:main_fs:104:rcode (RESPUESTA syscall) -2
			 fs.c:fs_reply:415:Send a fs_reply to a user process.
			 fs.c:fs_reply:419:source=0 type=-2 m1i1=0 m1i2=0 m1i3=0 m1p1=(nil) m1p2=(nil) m1p3=(nil) 
			 task.c:get_task:335:p_ep=1 p_nr=1
			 task.c:get_task:344:pproc=504798C
			 mukipc.c:muk_send_T:136:dst_ep:22 current_ep=1
			 mukipc.c:muk_send_T:138:nr=1 endp=1 dcid=0 flags=0 misc=400 lpid=2 vpid=6 nodeid=0 name=fs 
			 task.c:get_task:335:p_ep=22 p_nr=22
			 task.c:get_task:344:pproc=50479E0
			 mukipc.c:muk_send_T:146:nr=22 endp=22 dcid=0 flags=8 misc=400 lpid=2 vpid=8 nodeid=0 name=nweb 
			 mukipc.c:muk_send_T:150:dst_ep:22 WAITING FOR THIS MESSAGE
			 mukipc.c:muk_send_T:156:p_proc->p_rts_flags:0
			 rendez.c:taskwakeup:45:id=10
			 rendez.c:_taskwakeup:25:
			 rendez.c:_taskwakeup:32:id=10
			 rendez.c:_taskwakeup:35:i=1
			 fs.c:fs_reply:422:rcode=0
 

TODO:
		1)	/proc/DC0/procs Cuando se hace el tbind, el nombre de los procesos no aparece (aparece muk2)
				se supone que sys_rsetpname deberia cambiar el nombre 
				PROBLEMA: NO HAY SOLUCION, LO QUE APARECE EN ESTE LISTADO SON LOS DVK THREADS DE LAS TASKS
				NO HAY FORMA DE CAMBIAR EL NOMBRE SIN TENER SYSTASK EN DVK (LA SYSTASK DE MUK2 ESTA EN MUK2) 
				
		2)	la info del FS tampoco tiene los nombres de los procesos, la del PM si 
				PROBLEMA: NO HAY SOLUCION, LA ESTRUCTURA  fproc_t NO TIENE CAMPO DE NOMBRE 
		 
			
			
ERROR: M3FTP 
	 
	 CLIENT 
		< m3ftp.c:main:247:M3FTP: request source=14 type=3 m1i1=11 m1i2=65536 m1i3=0 m1p1=0xbff6be31 m1p2=0xfb8000 m1p3=(nil) 
		DEBUG 10:dvk_sendrec_T:866: endpoint=14 timeout=-1
		DEBUG 10:dvk_sendrec_T:870: ipc ret=0
		 m3ftp.c:main:250:M3FTP: reply   source=14 type=0 m1i1=11 m1i2=65536 m1i3=0 m1p1=0xbff6be31 m1p2=0xfb8000 m1p3=(nil)
		 
		< m3ftp.c:main:247:M3FTP: request source=14 type=3 m1i1=11 m1i2=65536 m1i3=0 m1p1=0xbff6be31 m1p2=0xfb8000 m1p3=(nil) 
		DEBUG 10:dvk_sendrec_T:866: endpoint=14 timeout=-1
		DEBUG 10:dvk_sendrec_T:870: ipc ret=0
		 m3ftp.c:main:250:M3FTP: reply   source=14 type=0 m1i1=11 m1i2=65536 m1i3=0 m1p1=0xbff6be31 m1p2=0xfb8000 m1p3=(nil) 
		 
		< m3ftp.c:main:247:M3FTP: request source=14 type=3 m1i1=11 m1i2=65536 m1i3=0 m1p1=0xbff6be31 m1p2=0xfb8000 m1p3=(nil) 
		DEBUG 10:dvk_sendrec_T:866: endpoint=14 timeout=-1


	SERVER 
		 m3ftpd.c:main_ftpd:202:M3FTPD: DVK_receive_T
		 task.c:DVK_receive_T:91:nr=14 endp=14 dcid=0 flags=0 misc=400 lpid=2 vpid=9 nodeid=0 name=ftpd 
		 task.c:DVK_receive_T:99:PH_MTX_LOCK t->p_mutex 
		 task.c:DVK_receive_T:100:PH_COND_SIGNAL t->p_th_cond                  <<< SE SUPONE QUE DESPERTO AL THREAD 
		 task.c:DVK_receive_T:101:PH_COND_WAIT t->p_tsk_cond t->p_mutex
		 task.c:pth_dvk:212:PH_COND_WAIT t->p_th_cond t->p_mutex			   <<<< EL THREAD SE DUERME 

 
PROBLEMA: 	DEBE ESTAR BLOQUEADO 
			These functions shall unblock threads blocked on a condition variable.
			The pthread_cond_signal() function shall unblock at least one of the threads that are blocked
			on the specified condition variable cond (if any threads are blocked on cond).
 
SOLUCION:	SE CAMBIO LA SINCRONIZACION SOLO CON MUTEXES up(A),down(B) y el otro Down(A) up(B)

DC pnr -endp -lpid/vpid- nd flag misc -getf -sndt -wmig -prxy name
 0  -2    -2   689/3      0    0   20 27342 27342 27342 27342 muk2           
 0   0     0   691/5      0    0    0 27342 27342 27342 27342 muk2           
 0   1     1   692/6      0    0    0 27342 27342 27342 27342 muk2           
 0   3     3   690/4      0    0    0 27342 27342 27342 27342 muk2           
 0   8     8   693/7      0    0    0 27342 27342 27342 27342 muk2           
 0  14    14   695/9      0    8    0 31438 27342 27342 27342 muk2   <<<<< M3FTPD RECEIVING CON TIMEOUT 
 0  22    22   694/8      0    0    0 27342 27342 27342 27342 muk2           

root@node0:~# dmesg
[   69.904257] Started in network mode
[   69.904263] Own node address <1.1.100>, network identity 4711
[   69.907668] Enabled bearer <eth:eth0>, discovery domain <1.1.0>, priority 10
[  108.192637] ERROR: 688:check_caller:579: rcode=-310
[  108.193176] ERROR: 688:check_caller:579: rcode=-310
[  140.278200] ERROR: 695:ipc_mini_receive:500: rcode=-61 <<<<<<<<<<<<<<<<<<< EDVSTIMEDOUT 

root@node0:~# cat /proc/dvs/DC0/procs 
DC pnr -endp -lpid/vpid- nd flag misc -getf -sndt -wmig -prxy name
 0  -2    -2   689/3      0    0   20 27342 27342 27342 27342 muk2           
 0   0     0   691/5      0    0    0 27342 27342 27342 27342 muk2           
 0   1     1   692/6      0    0    0 27342 27342 27342 27342 muk2           
 0   3     3   690/4      0    0    0 27342 27342 27342 27342 muk2           
 0   8     8   693/7      0    0    0 27342 27342 27342 27342 muk2           
 0  14    14   695/9      0    0    0 27342 27342 27342 27342 muk2     <<<<<< DEJA DE ESTAR RECEIVING !!!!!     
 0  22    22   694/8      0    0    0 27342 27342 27342 27342 muk2   
 
 
	SE cambio la sincronizacion asi
			PROCESO PARENT 
				PH_MTX_UNLOCK(t->p_th_mutex);  
				PH_MTX_LOCK(t->p_tsk_mutex);    
			PROCESO CHILD 
				PH_MTX_LOCK(t->p_th_mutex);
				PH_MTX_UNLOCK(t->p_tsk_mutex);

		
ULTIMO_LOG 		
=====================================================================================================

ERROR:	ANDA MAL EL REGISTRO DE TIEMPOS 
		t_start=796533.00 t_stop=693299.00 t_total=-103234.00
		total_bytes = 103730
		Throuhput = -1.004805 [bytes/s]
		t_start=860439.00 t_stop=665281.00 t_total=-195158.00
		total_bytes = 103730
		Throuhput = -0.531518 [bytes/s]
		t_start=344936.00 t_stop=164486.00 t_total=-180450.00
		total_bytes = 103730
		Throuhput = -0.574841 [bytes/s]
		t_start=549012.00 t_stop=375500.00 t_total=-173512.00
		total_bytes = 103730
		Throuhput = -0.597826 [bytes/s]
		t_start=684145.00 t_stop=637770.00 t_total=-46375.00
		total_bytes = 103730
		Throuhput = -2.236765 [bytes/s]
		t_start=639695.00 t_stop=535057.00 t_total=-104638.00
		total_bytes = 0
		t_start=-nan t_stop=508960.00 t_total=226458.00
		total_bytes = 103730
		Throuhput = 0.458054 [bytes/s]
		t_start=-nan t_stop=513242.00 t_total=3794.00
		total_bytes = 0
		t_start=-nan t_stop=326901.00 t_total=-472027.00
		total_bytes = 0
		t_start=179644.00 t_stop=119667.00 t_total=-59977.00
		total_bytes = 103730
		Throuhput = -1.729496 [bytes/s]
		t_start=119930.00 t_stop=951194.00 t_total=831264.00
		total_bytes = 0
		t_start=-nan t_stop=951985.00 t_total=572299.00
		total_bytes = 0


ATENCION: libtask brinda funciones propias para sustituir PRINTF y otras
		utilizar estas funciones en lugar de las estandar sobre todo en DEBUG y MACROS 
		NO PARECEN SER USADAS ??

TODO: Se podria hacer una consola externa para controlar ciertas cosas en forma similar a UML
		por ejemplo agregando al IS un nuevo servidor que se llame con_server que estaria 
		escuchando en algun socket UDP, para que sea remotizable.
		luego, un comando externo haria 
					# muk2cmd	<command>
					<command>:
							help 
							dc
							sys_proc
							rd 
							pm_proc
							fs_proc
							fs_super
							
Ver makefile de  https://github.com/jbleners/Falcon

Se podria hacer una especie de whatdog.
Cada Tarea tiene un contador que se va decrementando una vez por segundo si no ha tenido actividad.
Cuando hay actividad (en el receive, por ejemplo) vuelve el contador a su valor inicial.
Para el caso del web server que espera en el socket, entonces no deberia implementarse.
para ello habria que poner un MISC-FLAG que indique que se quiere controlar si esta dormido.

		
	
	
		

		
		
		



	
	
	










	


